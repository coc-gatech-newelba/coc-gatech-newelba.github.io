---
layout: page
title: ".NSFile"
date: 2018-03-23 16:44:11.000000000 -04:00
type: page
parent_id: '0'
published: true
password: ''
status: publish
categories: []
tags: []
meta:
  _wp_page_template: ''
  _publicize_pending: '1'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
author:
  login: gtelbaproject
  email: gt.elba.project@gmail.com
  display_name: GT Elba Project
  first_name: GT Elba
  last_name: Project
---
<h3 id="DesigningaNetworkTopology">Designing a Network Topology</h3>
<p><a class="button" href="https://gtelbatutorial.wordpress.com/nsfile-example/">.NSFile Example</a> <a class="button" href="https://gtelbatutorial.wordpress.com/ns-commands/">NS Commands</a>&nbsp;<a class="button" href="https://gtelbatutorial.wordpress.com/2018/02/22/introduction-to-elba">Home</a></p>
<p>Part of Emulab's power lies in its ability to assume many different topologies; the description of a such a topology is a necessary part of an experiment. (Note: You may want to take a look at our <a class="ext-link" href="https://www.emulab.net/clientui.php3"><span class="icon">Java GUI</span></a> to build experiments without directly editing NS files.) Emulab uses the "NS" ("Network Simulator") format to describe network topologies. This is substantially the same <a class="ext-link" href="http://www.scriptics.com/software/tcltk/"><span class="icon">Tcl</span></a>-based format used by <a class="ext-link" href="http://www.isi.edu/nsnam/ns/"><span class="icon">ns-2</span></a>. Since Emulab offers emulation, rather than simulation, these files are interpreted in a somewhat different manner than ns-2. Therefore, some ns-2 functionality may work differently than you expect, or may not be implemented at all. Please look for warnings of the form:</p>
<p>If you feel there is useful functionality missing, please let us know. Also, some <a class="wiki" href="https://wiki.emulab.net/wiki/Emulab/wiki/nscommands">testbed-specific syntax</a> has been added, which with the inclusion of compatibility module (tb_compat.tcl), will be ignored by the NS simulator. This allows the same NS file to work on both Emulab and ns-2, most of the time.</p>
<p>For those unfamiliar with the NS format, here is a small example (<i>We urge all new Emulab users to begin with a small 3-5 node experiment such as this, so that you will become familiar with NS syntax and the practical aspects of Emulab operation</i>). Let's say we are trying to create a test network which looks like the following:</p>
<p><img title="Abcd.Png" src="{{ site.baseurl }}/assets/abcd.png?format=raw" alt="Abcd.Png" /></p>
<p>(A is connected to B, and B to C and D with a LAN.)<br />
An NS file which would describe such a topology is as follows. First off, all NS files start with a simple prologue, declaring a simulator and including a file that allow you to use the special <tt>tb-</tt>commands:</p>
<pre class="wiki">  	# This is a simple ns script. Comments start with #.
  	set ns [new Simulator]
        source tb_compat.tcl
</pre>
<p>Then define the 4 nodes in the topology.</p>
<pre class="wiki">  	set nodeA [$ns node]
  	set nodeB [$ns node]
  	set nodeC [$ns node]
  	set nodeD [$ns node]
</pre>
<p><tt>nodeA</tt> and so on are the virtual names (vnames) of the nodes in your topology. When your experiment is swapped in, they will be assigned to physical node names like "pc45", probably different ones each time. (<strong>NOTE:</strong> It's a bad idea to pick vnames that clash with the physical node names in the testbed.)</p>
<p>Next define the link and the LAN that connect the nodes. NS syntax permits you to specify the bandwidth, latency, and queue type. Note that since NS can't impose artificial losses like Emulab can, there is a separate command to add loss on a link. For our example, we will define a full speed LAN between B, C, and D, and a shaped link from node A to B.</p>
<pre class="wiki">  	set link0 [$ns duplex-link $nodeB $nodeA 30Mb 50ms DropTail]
  	tb-set-link-loss $link0 0.01
  	set lan0 [$ns make-lan "$nodeD $nodeC $nodeB " 100Mb 0ms]
</pre>
<p>In addition to the standard NS syntax above, a number of <a class="wiki" href="https://wiki.emulab.net/wiki/Emulab/wiki/nscommands">extensions</a> have been added that allow you to better control your experiment.</p>
<p>For example, you may specify what Operating System is booted on your nodes. We currently support FreeBSD 4.10, FreeBSD 6.2, <a class="wiki" href="https://wiki.emulab.net/wiki/Emulab/wiki/RedHat">RedHat</a> Linux 9.0, Fedora Core 4, Fedora Core 6, and <a class="wiki" href="https://wiki.emulab.net/wiki/Emulab/wiki/Windows">Windows XP</a>. <a class="ext-link" href="http://www.emulab.net/kb-show.php3?xref_tag=SWS-WIN2K"><span class="icon">Windows 2000</span></a> is not supported. Fedora Core 2 (Linux 2.6) is available but unsupported. We also support <a class="ext-link" href="http://www.cs.utah.edu/flux/oskit/"><span class="icon">OSKit</span></a> kernels on the Emulab PCs.</p>
<p>Click <a class="ext-link" href="https://www.emulab.net/showosid_list.php3"><span class="icon">List ImageIDs and OSIDs</span></a> in the Emulab web interface "Interaction" pane to see the current list of Emulab-supplied OS. By default, our most recent Linux image is selected.</p>
<pre class="wiki">  	tb-set-node-os $nodeA FBSD-STD
  	tb-set-node-os $nodeC RHL-STD
  	tb-set-node-os $nodeC WINXP-UPDATE
</pre>
<p>In a topology like this, you will likely want to communicate between all the nodes, including nodes that aren't directly connected, like A and C. In order for that to happen, we must enable routing in our experiment, so B can route packets for the other nodes. The typical way to do this is with Static routing. (Other options are detailed below, in the Routing section below.</p>
<pre class="wiki">  	$ns rtproto Static
</pre>
<p>Lastly, all NS files end with an epilogue that instructs the simulator to start.</p>
<pre class="wiki"> 	# Go!
  	$ns run
</pre>
<p>If you would like to try the above example, the completed <a class="attachment" href="https://wiki.emulab.net/wiki/Emulab/wiki/attachment/Tutorial/basic.ns">NS file</a> can be run as an experiment in your project. Because NS is based on TCL, the full power of the TCL language is available for you to use in your NS files, including loops, control structures, and even procedures/functions. Here's an example of a simple loop: (Download this example: <a class="attachment" href="https://wiki.emulab.net/wiki/Emulab/wiki/attachment/Tutorial/loop.ns">loop.ns</a>)</p>
<pre class="wiki">  	# This is a simple ns script that demonstrates loops.
  	set ns [new Simulator]
  	source tb_compat.tcl
  	set maxnodes 3
  	set lanstr ""
  	for {set i 1} {$i &lt;= $maxnodes} {incr i} {
  	    set node($i) [$ns node]
  	    append lanstr &quot;$node($i) &quot;
  	    tb-set-node-os $node($i) FBSD-STD
  	}
  	# Put all the nodes in a lan
  	set big-lan [$ns make-lan &quot;$lanstr&quot; 100Mb 0ms]
  	# Go!
  	$ns run
</pre>
<p><a name="section-5"></a></p>
<h3 id="BeginningtheExperiment">Beginning the Experiment</h3>
<p>After logging on to the Emulab Web Interface, choose the "Begin Experiment" option from the menu. First select which project you want the experiment to be configured in. Most people will be a member of just one project, and will not have a choice. If you are a member of multiple projects, be sure to select the correct project from the menu. Next fill in the <tt>Name' and </tt>Description' fields. The Name should be a single word (no spaces) identifier, while the Description is a multi word description of your experiment. In the "Your NS file" field, place the <i>local path</i> of an NS file which you have created to describe your network topology. This file will be uploaded through your browser when you choose "Submit." After submission, Emulab will begin processing your request. This will likely take several minutes, depending on how large your topology is, and what other features (such as delay nodes and bandwidth limits) you are using. Assuming all goes well, you will receive an email message indicating success or failure, and if successful, a listing of the nodes and IP address that were allocated to your experiment. For the NS file described above, you would receive a listing that looks similar to this:</p>
<pre class="wiki">  	Virtual Node Info:
  	ID              Type         OS              Qualified Name
  	--------------- ------------ --------------- --------------------
  	nodeA           pc			     nodeA.myexp.myproj.emulab.net
  	nodeB           pc                           nodeB.myexp.myproj.emulab.net
  	nodeC           pc                           nodeC.myexp.myproj.emulab.net
  	nodeD           pc                           nodeD.myexp.myproj.emulab.net
  	Physical Node Mapping:
  	ID              Type         OS              Physical
  	--------------- ------------ --------------- ------------
  	tbsdelay0       pc850        FBSD47-STD      pc61
  	nodeB           pc850        RHL73-STD       pc63
  	nodeC           pc600        RHL73-STD       pc31
  	nodeD           pc600        RHL73-STD       pc34
  	nodeA           pc600        RHL73-STD       pc13
  	Virtual Lan/Link Info:
  	ID              Member          IP/Mask         Delay     BW (Kbs)  Loss Rate
  	--------------- --------------- --------------- --------- --------- ---------
  	lan0            nodeC:0         10.1.2.3        0.00      100000    0.000
  	                                255.255.255.0   0.00      100000    0.000
  	lan0            nodeB:1         10.1.2.4        0.00      100000    0.000
  	                                255.255.255.0   0.00      100000    0.000
  	lan0            nodeD:0         10.1.2.2        0.00      100000    0.000
  	                                255.255.255.0   0.00      100000    0.000
  	link0           nodeB:0         10.1.1.2        25.00     30000     0.005
  	                                255.255.255.0   25.00     30000     0.005
  	link0           nodeA:0         10.1.1.3        25.00     30000     0.005
  	                                255.255.255.0   25.00     30000     0.005
  	Physical Lan/Link Info:
  	ID              Member          Delay Node   Delay    BW (Kbs) PLR    Pipe
  	--------------- --------------- ------------ -------- -------- ------ ---------
  	link0           nodeA           tbsdelay0    50.00    30000    0.010  100
  	link0           nodeB           tbsdelay0    50.00    30000    0.010  110
  	Route List:
  	Node            Interface       Dest            Nexthop         Type  Cost
  	--------------- --------------- --------------- --------------- ----- ----
  	nodeA           10.1.1.3     10.1.2.4     10.1.1.2     host  0
  	nodeA           10.1.1.3     10.1.2.0     10.1.1.2     net   0
  	nodeC           10.1.2.3     10.1.1.0     10.1.2.4     net   0
  	nodeD           10.1.2.2     10.1.1.0     10.1.2.4     net   0
</pre>
<p>A few points should be noted:</p>
<ul>
<li>A single delay node was allocated and inserted into the link between nodeA and nodeB. This link is invisible from your perspective, except for the fact that it adds latency, error, or reduced bandwidth. However, the information for the delay links are included so that you can <a class="ext-link" href="http://www.emulab.net/kb-show.php3?xref_tag=modify-traffic-shaping"><span class="icon">modify the delay parameters</span></a> after the experiment has been created.</li>
<li>Delays of less than 2ms (per trip) are too small to be accurately modeled at this time, and will be silently ignored. A delay of 0ms can be used to indicate that you do not want added delay; the two interfaces will be "directly" connected to each other.</li>
<li>Each link in the "Virtual Lan/Link" section has its delay, etc., split between two entries. One is for traffic coming into the link from the node, and the other is for traffic leaving the link to the node. In the case of links, the four entries often get optimized to two entries in the "Physical Lan/Link" section.</li>
<li>The names in the "Qualified Name" column refer to the control network interfaces for each of your allocated nodes. These names are added to the Emulab nameserver map on the fly, and are immediately available for you to use so that you do not have to worry about the actual physical node names that were chosen. In the names listed above, <tt>myproj' is the name of the project that you chose to work in, and </tt>myexp' is the name of the experiment that you provided in the "Begin an Experiment" page.</li>
<li>Please don't use the "Qualified Name" from within nodes in your experiment, since it will contact them over the control network, bypassing the link shaping we configured. (See also these two FAQ entries: <a class="ext-link" href="http://www.emulab.net/kb-show.php3?xref_tag=no-traffic-shaping"><span class="icon">here</span></a> and <a class="ext-link" href="http://www.emulab.net/kb-show.php3?xref_tag=node-naming"><span class="icon">here</span></a>.)</li>
</ul>
<p><a name="section-6"></a></p>
<h3 id="UsingyourNodes">Using your Nodes</h3>
<blockquote><p>By the time you receive the email message listing your nodes, the Emulab configuration system will have ensured that your nodes are fully configured and ready to use. If you have selected one of the Emulab-supported operating system images (FreeBSD, Linux, or <a class="wiki" href="https://wiki.emulab.net/wiki/Emulab/wiki/Windows">Windows XP</a>), this configuration process includes:</p></blockquote>
<ul>
<li>loading fresh disk images so that each node is in a known clean state;</li>
<li>rebooting each node so that it is running the OS specified in the NS script;</li>
<li>configuring each of the network interfaces so that each one is "up" and talking to its virtual LAN (VLAN);</li>
<li>creating user accounts for each of the project members;</li>
<li>mounting the projects NFS directory in /proj so that project files are easily shared amongst all the nodes in the experiment;</li>
<li>creating a /etc/hosts file on each node so that you may refer to the experimental interfaces of other nodes by name instead of IP number;</li>
<li>configuring all of the delay parameters;</li>
<li>configuring the serial console lines so that project members may access the console ports from users.emulab.net or directly from their desktop.</li>
</ul>
<p>As this point you may log into any of the nodes in your experiment. You will need to use Secure Shell (ssh), and you should use the `qualified name' from the nodes mapping table so that you do not form dependencies on any particular physical node. Your login name and password will be the same as your Web Interface login and password. The /etc/hosts file on each node will provide a local name mapping for the other nodes in your experiments. You should take care to use these names (or IP numbers) and <strong>not</strong> the .emulab.net names listed in the node mapping, since the Emulab names refer to the control network LAN that is shared amongst all nodes in all experiments. It is only the experimental interfaces that are entirely private to your experiment. (See also these two FAQ entries: <a class="ext-link" href="http://www.emulab.net/kb-show.php3?xref_tag=no-traffic-shaping"><span class="icon">here</span></a> and <a class="ext-link" href="http://www.emulab.net/kb-show.php3?xref_tag=node-naming"><span class="icon">here</span></a>.) <strong>NOTE:</strong> The configuration process just described occurs only on Emulab constructed operating system images. If you are using an OSKit kernel, or your own disk image with your own operating system, you will be responsible for all of the configuration. At some point we hope to provide tools to assist in the configuration, but for now you are on your own. Ask <a class="ext-link" href="mailto:testbed-ops@flux.utah.edu"><span class="icon">Testbed Ops</span></a> for help or more information.</p>
<p><a name="section-7"></a></p>
<h3 id="Ineedrootaccess">I need <strong>root</strong> access!</h3>
<p>If you need to customize the configuration, or perhaps reboot nodes, you can use the "sudo" command, located in <tt>/usr/local/bin</tt> on FreeBSD and Linux, and <tt>/usr/pkg/bin</tt> on NetBSD. All users are added to the Administrators group on <a class="wiki" href="https://wiki.emulab.net/wiki/Emulab/wiki/Windows">Windows XP</a> nodes. Our policy is very liberal; you can customize the configuration in any way you like, provided it does not violate Emulab's <a class="wiki" href="https://wiki.emulab.net/wiki/Emulab/wiki/AdminPolicies">administrative policies</a>. As as example, to reboot a node that is running FreeBSD:</p>
<pre class="wiki">  	/usr/local/bin/sudo reboot
</pre>
<p><a name="section-8"></a></p>
<h3 id="Mynodeiswedged">My node is wedged!</h3>
<p>This is bound to happen when running experimental software and/or experimental operating systems. Fortunately we have an easy way for you to power cycle nodes without requiring Tested Operations to get involved. If you must power cycle a node, log on to users.emulab.net and use the "node_reboot" command:</p>
<pre class="wiki">  	node_reboot  [node ... ]
</pre>
<p>where <tt>node</tt> is the physical name, as listed in the node mapping table. You may provide more than one node on the command line. Be aware that you may power cycle only nodes in projects that you are member of. Also, <tt>node_reboot</tt> does its very best to perform a clean reboot before resorting to cycling the power to the node. This is to prevent the damage that can occur from constant power cycling over a long period of time. For this reason, <tt>node_reboot</tt> may delay a minute or two if it detects that the machine is still responsive to network transmission. In any event, please try to reboot your nodes first (see above). You may also reboot all the nodes in an experiment by using the <tt>-e</tt> option to specify the project and experiment names. For example:</p>
<pre class="wiki">  	node_reboot -e testbed,multicast
</pre>
<p>will reboot all of the nodes reserved in the "multicast" experiment in the "testbed" project. This option is provided as a shorthand method for rebooting large groups of nodes.</p>
<p><a name="section-9"></a></p>
<h3 id="Ivescroggedmydisk">I've scrogged my disk!</h3>
<p>Scrogging your disk is certainly not as common, but it does happen. You can either terminate your experiment, and recreate it (which will allocate another group of nodes), or if you prefer you can reload the disk image yourself. You will of course lose anything you have stored on that disk; it is a good idea to store only data that can be easily recreated, or else store it in your project directory in <tt>/proj</tt>. Reloading your disk with a fresh copy of the default image is easy, and requires no intervention by Emulab staff:</p>
<pre class="wiki">  	os_load  [node ... ]
</pre>
<p>os_load will wait (not exit) until the nodes have been reloaded, so that you do not need to check the console lines of each node to determine when the load is done.</p>
<p><a name="section-10"></a></p>
<h3 id="Ivefinishedmyexperiment">I've finished my experiment</h3>
<p>When your experiment is completed, and you no longer need the resources that have been allocated to it, you will need to terminate the experiment via the Emulab Web Interface. Click on the "End An Experiment" link. You will be presented with a list of all of the experiments in all of the projects for which you have the authorization to terminate experiments. Select the experiment you want to terminate by clicking on the button in the "Terminate" column on the right hand side. You will be asked to <strong>confirm</strong> your choice. The Emulab configuration system will then tear down your experiment, and send you an email message when the process is complete. At this point you are allowed to reuse the experiment name (say, if you wanted to create a similar experiment with different parameters).</p>
<p><a name="Halting"></a></p>
<p><a name="section-11"></a></p>
<h3 id="Schedulingexperimentswapouttermination">Scheduling experiment swapout/termination</h3>
<p>If you expect that your experiment should run for a set period of time, but you will not be around to terminate or swap the experiment out, then you should use the scheduled swapout/termination feature. This allows you to specify a maximum running time in your NS file so that you will not hold scarce resources when you are offline. This can also be used in conjunction with <a href="https://wiki.emulab.net/wiki/Tutorial#BatchMode">'batch mode'</a>experiments to ensure that they do not run longer than is reasonably expected. To schedule a swapout or termination in your NS file:</p>
<pre class="wiki">     $ns at 2000.0 "$ns terminate"
   or
     $ns at 2000.0 "$ns swapout"
</pre>
<p>This will cause your experiment to either be terminated or swapped out after 2000 seconds of wallclock time.</p>
<p><a name="section-12"></a></p>
<h3 id="GettingHelp1">Getting Help!</h3>
<p>If you have any questions or problems, or just want to comment on Emulab's operation (maybe you want to suggest an improvement to one of the Web pages), feel free to contact us by sending email to <a class="ext-link" href="http://www.emulab.net/sendemail.php3"><span class="icon">Testbed Operations</span></a>. Please send all correspondence to this address, not to individual members of our team. Messages that aren't on this list may not get responses. Also note that much of the software is in development, and occasionally things might break or not work as you expect. Again, please feel free to contact us.</p>
<hr />
